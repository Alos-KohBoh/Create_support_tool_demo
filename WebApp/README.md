# RPG創作支援ツール - RPGドロップシミュレーター & キャラクター・プロット管理

ExcelのVBAで作成されたRPGドロップシミュレーターをベースに、キャラクター管理、作品管理、プロット作成機能を統合したRPG創作総合支援ツールです。

## 🌟 特徴

- **🎲 ガチャシミュレーション**: モンスターのドロップテーブルをシミュレート
- **👥 キャラクター管理**: 詳細なキャラクター設定とステータス管理
- **📚 作品管理**: 複数の作品を管理、作品ごとにデータを紐付け
- **📖 プロット作成**: 章・シーン・タイムラインを構造的に管理
- **🎒 個別鞄システム**: キャラクターごとの所持品管理 + 共有倉庫
- **📊 レベル倍率**: モンスターレベルによるドロップ率変動（最大300%）
- **🖼️ 画像管理**: URL、ファイルアップロード、メディアライブラリから選択
- **📝 プロットエクスポート**: テキストコピーまたはファイル出力
- **💾 データ永続化**: LocalStorageで自動保存、エクスポート/インポート対応
- **📱 完全レスポンシブ**: PC、タブレット、スマートフォン全対応

## 📁 ファイル構成

```
WebApp/
├── index.html              # メインHTML
├── README.md              # このファイル
├── SETUP.md              # セットアップガイド
├── css/
│   └── style.css          # スタイルシート
└── js/
    ├── models.js          # データモデル定義
    ├── simulator.js       # シミュレーションエンジン
    ├── character.js       # キャラクター管理
    ├── work.js           # 作品管理
    ├── plot.js           # プロット管理
    ├── bag.js            # 鞄システム
    ├── media.js          # メディアライブラリ
    ├── master.js         # マスタデータ管理
    ├── navigation.js     # 画面遷移管理
    ├── ui.js            # UI管理
    └── app.js           # メインアプリケーション
```

## 🚀 使い方

### 起動方法

1. **ブラウザで直接開く**:
   - `index.html` をダブルクリック、または
   - ブラウザにドラッグ&ドロップ

2. **ローカルサーバーで起動（推奨）**:
   ```bash
   # Pythonの場合
   python -m http.server 8000
   
   # Node.jsの場合
   npx http-server
   ```
   ブラウザで `http://localhost:8000` にアクセス

3. **VS Code Live Server**:
   - Live Server拡張機能をインストール
   - `index.html` を右クリック → "Open with Live Server"

---

## 📚 機能詳細

### 1. 🎲 ガチャシミュレーション

**モンスター選択とシミュレーション**:
1. モンスターを選択
2. キャラクターを選択（ドロップ報酬の受取人）
3. モンスターレベルを入力（1〜で倍率変動）
4. 試行回数を入力（1〜100,000）
5. 「ガチャ開始」でシミュレーション実行

**レベル倍率システム**:
- 計算式: `1 + 2 × (1 - 1/レベル)`
- レベル2: 1.5倍
- レベル10: 1.8倍
- レベル100: 1.98倍
- 高レベルほど最大300%に近づく

**結果表示**:
- **集計結果**: アイテムごとのドロップ数・割合・期待値比較
- **期待値**: 理論値とのギャップを視覚化
- **ログ**: 全試行の詳細履歴（最新100件）
- **グラフ**: Chart.jsによる実績vs期待値の比較

**鞄への追加**:
- 「すべて鞄に入れる」ボタンで選択キャラクターの鞄にまとめて追加
- 個別に「鞄に入れる」ボタンで特定アイテムのみ追加

---

### 2. 👥 キャラクター管理

**基本情報**:
- 名前、年齢、性別
- 職業、種族
- 画像（URL/ファイル/メディアライブラリ）
- 所属作品

**詳細設定**:
- ステータス（HP、MP、攻撃力、防御力、素早さ、魔力）
- レベル
- 説明、性格、背景

**個別鞄システム**:
- 各キャラクターが個別の鞄を所持
- アイテムの個数管理
- 使用・削除機能
- 共有倉庫との切り替え

**フィルター機能**:
- 名前、職業、種族で絞り込み
- 所属作品で絞り込み

---

### 3. 📚 作品管理

**作品の作成**:
- タイトル、ジャンル、説明
- 各作品に紐づいたキャラクター・プロット管理

**データの紐付け**:
- キャラクター → 作品
- 章・シーン → 作品
- タイムラインイベント → 作品

**切り替え**:
- 作品を選択すると、その作品に関連するデータのみ表示

---

### 4. 📖 プロット作成・管理

**章（チャプター）管理**:
- 章タイトル、説明
- ステータス（未着手/進行中/完了）
- 順序管理

**シーン管理**:
- シーンタイトル、内容
- 場所、時間帯
- 登場キャラクター選択
- メモ機能

**タイムライン**:
- イベント名、タイムスタンプ
- 説明、関連章
- 時系列順の自動ソート

**プロットエクスポート機能** 🆕:
- **📋 テキストコピー**: ワンクリックでクリップボードにコピー
- **💾 ファイル出力**: `.txt`ファイルとしてダウンロード
- **出力内容**:
  - 作品情報（タイトル、ジャンル、概要）
  - 登場キャラクター一覧（詳細情報付き）
  - 章・シーン構造（場所、時間帯、登場人物、内容、メモ）
  - タイムライン（時系列イベント）
  - 出力日時

**使い方**:
1. 作品一覧から作品を選択
2. 章編集画面で「📋 テキストコピー」または「💾 ファイル出力」をクリック
3. テキストエディタ、Word、メモ帳などで編集可能

---

### 5. 🎒 鞄システム

**キャラクター別鞄**:
- 各キャラクターが独立した鞄を所持
- ガチャ結果を指定キャラクターの鞄に追加
- キャラクターごとにアイテムの所持数を管理

**共有倉庫**:
- 全キャラクター共通のストレージ
- 鞄選択で「倉庫」を選ぶと表示
- 手動でアイテムを追加・管理

**機能**:
- アイテム追加（手動入力）
- アイテム使用（個数-1）
- アイテム削除
- 鞄クリア（全削除）

---

### 6. 🖼️ 画像管理システム

**3つの画像入力方法**:
1. **URL直接入力**: 外部URLをテキストフィールドに入力
2. **ファイルアップロード**: 「ファイル」ボタンからローカル画像を選択
3. **メディアライブラリ**: 「ライブラリ」ボタンから過去の画像を再利用

**メディアライブラリ機能**:
- Base64形式でLocalStorageに保存（5MB/画像制限）
- グリッド表示で一覧
- 画像の追加・削除
- ストレージ使用量表示
- エクスポート/インポート対応

**対応箇所**:
- キャラクター画像
- モンスター画像
- アイテム画像

---

### 7. 📊 データ管理

**モンスター管理**:
- 名前、危険度、レア度
- ドロップテーブル設定
- 画像、説明

**アイテム管理**:
- 名前、種別、レア度
- 効果、画像、説明

**ドロップテーブル設定**:
- 各モンスターにアイテムとドロップ率を設定
- 合計確率の自動計算と検証
- リアルタイムで残り確率を表示

**マスタデータ管理**:
- 職業、種族のカスタマイズ
- アイテム種別の追加
- レア度の定義

**データのエクスポート/インポート**:
- JSON形式で全データを保存
- バックアップと復元
- バージョン管理（現在v2.2）
- メディアライブラリデータも含む

---

## 📊 機能一覧

### コア機能

| 機能 | 説明 |
|------|------|
| ガチャシミュレーション | 確率ベースのドロップシミュレート |
| レベル倍率 | モンスターレベルでドロップ率変動（最大300%） |
| 期待値計算 | 理論値vs実績の比較 |
| 統計・グラフ | Chart.jsによる可視化 |
| ログ記録 | 全試行の詳細履歴 |

### キャラクター・作品管理

| 機能 | 説明 |
|------|------|
| キャラクター管理 | 詳細設定、ステータス、個別鞄 |
| 作品管理 | 複数作品の管理と切り替え |
| プロット作成 | 章・シーン・タイムライン構造化 |
| プロットエクスポート | テキストコピー/ファイル出力 |
| フィルター | 作品・職業・種族で絞り込み |

### データ管理

| 機能 | 説明 |
|------|------|
| 画像管理 | URL/ファイル/ライブラリ |
| メディアライブラリ | Base64保存、5MB制限 |
| 鞄システム | キャラクター別+共有倉庫 |
| エクスポート/インポート | JSON形式、バージョン管理 |
| LocalStorage | 自動保存 |

---

## 🎮 サンプルデータ

初回起動時に自動作成されるサンプルデータ:

### モンスター (3体)
- スライム
- レッサーウルフ
- ホーンラビット

### アイテム (15種類)
- スライムゼリー
- レッサーウルフの毛皮
- 角ウサギの毛皮
- など

### マスタデータ
- 職業: 戦士、魔法使い、盗賊、僧侶
- 種族: 人間、エルフ、ドワーフ、獣人
- アイテム種別: ドロップアイテム、装備、消耗品、素材
- レア度: コモン、アンコモン、レア、エピック、レジェンド

---

## 🔧 技術スタック

- **HTML5**: セマンティックマークアップ
- **CSS3**: 
  - Grid/Flexbox レイアウト
  - CSS Variables（カラーテーマ）
  - アニメーション・トランジション
  - 完全レスポンシブデザイン
  - メディアクエリ（480px, 768px, 769-1024px, 1024px）
- **JavaScript (ES6+)**:
  - クラスベースOOP設計
  - モジュール分割
  - LocalStorage API
  - Clipboard API
  - FileReader API（画像アップロード）
  - Blob API（ファイル出力）
- **Chart.js 3.x**: データビジュアライゼーション

---

## 🎨 デザイン

- **カラーテーマ**: プロフェッショナルなブルー基調
- **カード型レイアウト**: モダンなUI設計
- **アニメーション**: スムーズな画面遷移
- **アイコン**: 絵文字で直感的な操作性
- **レスポンシブ**: 4段階のブレークポイント

---

## 📱 対応ブラウザ

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+
- モバイルブラウザ（iOS Safari, Chrome Mobile）

---

## ⚙️ カスタマイズ

### 配色変更

`css/style.css` の `:root` 部分:

```css
:root {
    --primary-color: #0078d4;
    --secondary-color: #605e5c;
    --danger-color: #d13438;
    /* ... */
}
```

### 試行回数上限変更

`js/app.js` の `runSimulation()`:

```javascript
if (trialCount <= 0 || trialCount > 100000) {
    alert('試行回数は1〜100000の範囲で入力してください');
}
```

### 画像サイズ制限変更

`js/media.js` の `addImage()`:

```javascript
const MAX_SIZE = 5 * 1024 * 1024; // 5MBに変更可能
```

---

## 🆚 VBA版との対応

| VBA機能 | Web版実装 |
|---------|----------|
| `ガチャ開始()` | `simulator.runSimulation()` |
| `期待値計算()` | `simulator.calculateExpectedValues()` |
| `AddMonster()` | `app.saveMonster()` |
| `AddItem()` | `app.saveItem()` |
| Dictionary | JavaScript Object |
| Randomize/Rnd | `Math.random()` |
| UserForm | モーダルダイアログ |
| ワークシート | LocalStorage + JSON |

---

## 💡 使用例

### 1. 新しい作品の創作開始
1. ホーム画面で「プロット作成・管理」を選択
2. 「新規作品を作成」をクリック
3. タイトル・ジャンル・概要を入力
4. 「キャラクター管理」でキャラクターを作成（作品に紐付け）
5. プロット画面で章・シーンを作成

### 2. ドロップアイテムの検証
1. モンスターとドロップテーブルを設定
2. レベル倍率を考慮してシミュレーション
3. 期待値と実績を比較
4. 確率調整してバランス取り

### 3. プロットの執筆支援
1. 章・シーン構造を作成
2. タイムラインで時系列整理
3. 「プロットエクスポート」でテキスト出力
4. Wordやメモ帳で執筆開始

---

## 🚀 今後の拡張アイデア

- [ ] マークダウン形式でのエクスポート
- [ ] PDF出力機能
- [ ] キャラクター相関図の自動生成
- [ ] 複数言語対応（i18n）
- [ ] クラウド同期機能
- [ ] テーマカラー切り替え（ダーク/ライトモード）
- [ ] ドロップ率の視覚的エディタ
- [ ] AIによるプロット提案機能

---

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

---

## 🤝 貢献

バグ報告、機能リクエスト、プルリクエストを歓迎します！

---

**Enjoy your RPG creation! 🎮✨**

- [ ] 複数モンスターの比較機能
- [ ] 確率の偏差分析
- [ ] ガチャ天井システムのシミュレーション
- [ ] テーマカラーの切り替え
- [ ] モンスター/アイテムの削除機能
- [ ] ドロップ履歴のフィルタリング
- [ ] PWA対応（オフライン動作）

## 📝 ライセンス

このプロジェクトは元のExcel VBAシステムを基に作成されています。

## 🙏 使用ライブラリ

- [Chart.js](https://www.chartjs.org/) - MIT License

---

**開発日**: 2025年12月10日
