# RPG創作支援ツール - 総合プロジェクト管理システム

ExcelのVBAで作成されたRPGドロップシミュレーターをベースに、**20の包括的な機能**を統合したRPG創作支援の決定版ツールです。

## 🌟 主要機能（全20機能実装済み）

### 📁 **フェーズ1: 基本インフラ**
1. ✅ **バックアップ・復元機能** - 自動/手動バックアップ、データ復元
2. ✅ **マルチプロジェクト管理** - 複数作品の並行管理、プロジェクト切替
3. ✅ **タグ・カテゴリ分類** - キャラクター、章、シーンのタグ管理

### 👥 **フェーズ2: キャラクター強化**
4. ✅ **関係性マップ** - キャラクター間の人間関係可視化
5. ✅ **成長システム** - 経験値、レベルアップ、スキル習得
6. ✅ **装備アイテム管理** - キャラクター専用鞄と共有倉庫

### 📖 **フェーズ3: プロット管理**
7. ✅ **シーンカード** - カンバン方式のシーン管理
8. ✅ **キャラ登場追跡** - キャラクター別の出演シーン追跡
9. ✅ **プロット分析** - 章構成と展開の統計分析

### 🤖 **フェーズ4: AI支援機能**
10. ✅ **プロット生成AI** - AIによる物語展開の提案
11. ✅ **セリフ提案AI** - キャラクター性格に基づくセリフ生成
12. ✅ **整合性チェック** - 設定矛盾の自動検出

### 🤝 **フェーズ5: コラボレーション**
13. ✅ **作品共有機能** - 他ユーザーへの作品共有
14. ✅ **コメント・レビュー** - 章・シーン別のフィードバック機能
15. ✅ **変更履歴** - 編集履歴の記録と差分表示

### 📤 **フェーズ6: 出力・公開**
16. ✅ **PDF出力** - 作品のPDF化（jsPDF使用）
17. ✅ **HTML出力** - Web公開用HTMLファイル生成
18. ✅ **統計グラフ** - Chart.jsによる進捗・構成の可視化

### 🗺️ **フェーズ7: 世界観構築**
19. ✅ **テンプレート機能** - キャラクター・章構成テンプレート
20. ✅ **ワールドマップ** - 世界観設定と地理管理

## 📁 ファイル構成

```
WebApp/
├── index.html              # メインHTML（1650行）
├── README.md              # このファイル
├── SETUP.md              # セットアップガイド
├── css/
│   └── style.css          # 統合スタイルシート（3850行）
└── js/
    ├── models.js          # データモデル・バックアップ・プロジェクト管理
    ├── character.js       # キャラクター・関係性管理
    ├── work.js           # 作品管理
    ├── plot.js           # プロット・章・シーン管理
    ├── simulator.js      # ドロップシミュレーション
    ├── bag.js            # 鞄・アイテム管理
    ├── media.js          # メディアライブラリ
    ├── collaboration.js  # 共有・コメント・履歴
    ├── output.js         # PDF/HTML出力
    ├── templates.js      # テンプレート・ワールドマップ
    ├── master.js         # マスタデータ管理
    ├── navigation.js     # 画面遷移管理
    ├── ui.js            # UI管理
    └── app.js           # メインアプリケーション（4810行）
```

## 🚀 使い方

### 起動方法

1. **ブラウザで直接開く**:
   - `index.html` をダブルクリック、または
   - ブラウザにドラッグ&ドロップ

2. **ローカルサーバーで起動（推奨）**:
   ```bash
   # Pythonの場合
   python -m http.server 8000
   
   # Node.jsの場合
   npx http-server
   ```
   ブラウザで `http://localhost:8000` にアクセス

3. **VS Code Live Server**:
   - Live Server拡張機能をインストール
   - `index.html` を右クリック → "Open with Live Server"

---

## 📚 機能詳細

### 🎯 **プロジェクト管理**

**複数プロジェクトの並行管理**:
- プロジェクト作成・切替・削除
- プロジェクトごとに独立したデータ管理
- インポート・エクスポート機能

**バックアップ機能**:
- 自動バックアップ（設定可能な間隔）
- 手動バックアップ（いつでも実行可能）
- バックアップからの復元

---

### 👥 **キャラクター管理**

**基本情報**:
- 名前、年齢、性別
- 職業、種族、属性
- 画像（URL/ファイル/メディアライブラリ）

**成長システム**:
- 経験値・レベル管理
- レベルアップ履歴
- カスタムステータス（HP、MP、攻撃力等）
- スキル習得・管理

**関係性マップ**:
- キャラクター間の関係性定義
- 関係性の種類（友人、敵対、恋愛等）
- 相関図表示

**装備・所持品**:
- キャラクター専用鞄
- 共有倉庫システム
- アイテムの使用・削除

---

### 📖 **作品・プロット管理**

**作品管理**:
- 複数作品の並行管理
- 作品タイトル、ジャンル、説明
- 作品別のキャラクター・章管理

**世界観設定**:
- 作品ごとの世界観記述エリア
- 時代背景、魔法体系、社会構造の詳細記述
- 最終更新日時の自動記録

**章・シーン管理**:
- 章の作成・編集・削除・並び替え
- シーンカード形式の管理
- シーンごとの登場キャラクター指定
- 場所・時間帯の設定

**タイムライン機能**:
- 作品全体の時系列イベント管理
- イベントの日時・説明
- タイムライン表示

**プロット分析**:
- 章別の文字数・シーン数統計
- キャラクター登場頻度
- 進捗状況の可視化

---

### 🎲 **ドロップシミュレーション**

**モンスター・アイテム管理**:
- モンスターのドロップテーブル設定
- レア度・確率の調整
- レベル倍率システム（最大300%）

**シミュレーション実行**:
1. モンスター選択
2. キャラクター選択（報酬受取人）
3. モンスターレベル入力
4. 試行回数設定（1〜100,000回）
5. 実行結果の詳細表示

**結果分析**:
- 集計結果（アイテムごとの数・割合）
- 期待値との比較
- Chart.jsによるグラフ表示
- 詳細ログ（最新100件）

---

### 🗺️ **ワールドマップ機能**

**場所管理**:
- 都市、ダンジョン、自然、建物などの場所登録
- 場所の説明・特徴記述
- タイプ別フィルタリング
- 検索機能

**場所間の接続**:
- 場所同士の繋がり管理
- 接続情報の記録

---

### 🤖 **AI支援機能**

**プロット生成**:
- 現在の章から次の展開を提案
- キャラクターの性格を考慮した提案

**セリフ提案**:
- キャラクター性格に基づいたセリフ生成
- シーンの状況を考慮

**整合性チェック**:
- キャラクター設定の矛盾検出
- プロット上の論理的不整合の指摘

---

### 🤝 **コラボレーション機能**

**作品共有**:
- 共有リンクの生成
- エクスポート・インポート機能
- 他ユーザーへの作品提供

**コメント・レビュー**:
- 章・シーン別のコメント
- コメント者名の記録
- 解決済みマーク
- コメント一覧表示

**変更履歴**:
- すべての編集操作を記録
- タイプ別・アクション別フィルタ
- 作成・更新・削除の追跡
- タイムスタンプ付き履歴

---

### 📤 **出力・公開機能**

**PDF出力**:
- 作品全体のPDF化
- オプション選択（キャラクター情報、画像、統計含む/含まない）
- jsPDF使用

**HTML出力**:
- Web公開用HTMLファイル生成
- スタイル込みのスタンドアロンファイル

**プレビュー**:
- 出力前のプレビュー表示
- 新しいウィンドウで確認

**統計グラフ**:
- 章別文字数（棒グラフ）
- 執筆進捗（折れ線グラフ）
- シーン分布（ドーナツグラフ）
- キャラクター登場頻度（横棒グラフ）

---

### 📋 **テンプレート機能**

**キャラクターテンプレート**:
- よく使うキャラクター設定を保存
- テンプレートから新規キャラクター作成
- テンプレート一覧表示・削除

**章構成テンプレート**:
- 章の構成パターンを保存
- 別作品への適用
- テンプレート管理

---

### 🖼️ **メディアライブラリ**

**画像管理**:
- URL指定
- ファイルアップロード
- メディアライブラリから選択
- サムネイル表示
- 画像の削除

---

### 💾 **データ管理**

**自動保存**:
- LocalStorageに自動保存
- ページ離脱時も安全

**エクスポート**:
- JSON形式でのデータエクスポート
- プロジェクト単位でのエクスポート

**インポート**:
- JSONファイルからのインポート
- データのマージ・上書き選択

**データリセット**:
- 初期状態への復元
- サンプルデータの自動生成

---

## 🎨 UI/UX特徴

- **完全レスポンシブ**: PC、タブレット、スマートフォン全対応
- **直感的なタブUI**: 機能ごとに整理されたタブ構成
- **モーダルダイアログ**: スムーズなデータ入力
- **カード型表示**: 視認性の高いデータ表示
- **ドラッグ&ドロップ**: ファイルアップロード対応
- **リアルタイムフィルタ**: 即座に絞り込み表示
- **アニメーション**: スムーズな画面遷移

---

## 🔧 技術スタック

- **フロントエンド**: 
  - HTML5
  - CSS3（Flexbox、Grid、CSS Variables）
  - Vanilla JavaScript（ES6+）

- **ライブラリ**:
  - Chart.js 4.4.0（統計グラフ）
  - jsPDF（PDF生成）

- **データ永続化**:
  - LocalStorage API

- **アーキテクチャ**:
  - モジュール型設計
  - クラスベースのオブジェクト指向
  - イベント駆動型

---

## 📊 データ構造

### LocalStorageキー一覧

```
基本データ:
- characters           # キャラクター一覧
- works               # 作品一覧
- currentWorkId       # 現在選択中の作品
- plot_chapters       # 章一覧
- plot_scenes         # シーン一覧
- plot_timeline       # タイムラインイベント
- character_relationships  # キャラクター関係性

プロジェクト管理:
- rpg_projects        # プロジェクト一覧
- rpg_current_project # 現在のプロジェクト
- proj_<id>_*         # プロジェクト別データ

機能別データ:
- rpg_media_library   # メディアライブラリ
- rpg_templates       # テンプレート
- rpg_locations       # ワールドマップ場所
- rpg_bag            # 共有鞄
- rpg_tags           # タグ管理
- worldsetting_<workId>  # 作品別世界観設定

コラボレーション:
- rpg_collab_comments_<workId>  # コメント
- rpg_collab_history_<workId>   # 変更履歴
- rpg_collab_share_*            # 共有データ

バックアップ:
- rpg_auto_backup_enabled       # 自動バックアップ有効化
- rpg_auto_backup_interval      # バックアップ間隔
- rpg_auto_backup_latest        # 最新バックアップ
```

---

## 🌐 ブラウザ対応

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

---

## 📝 ライセンス

このプロジェクトは個人利用・商用利用ともに自由です。

---

## 🤝 貢献

バグ報告、機能提案、プルリクエストを歓迎します。

---

## 📮 サポート

質問や問題がある場合は、Issueを作成してください。

---

**最終更新**: 2025年12月12日
**バージョン**: 2.0.0 - 全20機能実装完了版
- 所属作品

**詳細設定**:
- ステータス（HP、MP、攻撃力、防御力、素早さ、魔力）
- レベル
- 説明、性格、背景

**個別鞄システム**:
- 各キャラクターが個別の鞄を所持
- アイテムの個数管理
- 使用・削除機能
- 共有倉庫との切り替え

**フィルター機能**:
- 名前、職業、種族で絞り込み
- 所属作品で絞り込み

---

### 3. 📚 作品管理

**作品の作成**:
- タイトル、ジャンル、説明
- 各作品に紐づいたキャラクター・プロット管理

**データの紐付け**:
- キャラクター → 作品
- 章・シーン → 作品
- タイムラインイベント → 作品

**切り替え**:
- 作品を選択すると、その作品に関連するデータのみ表示

---

### 4. 📖 プロット作成・管理

**章（チャプター）管理**:
- 章タイトル、説明
- ステータス（未着手/進行中/完了）
- 順序管理

**シーン管理**:
- シーンタイトル、内容
- 場所、時間帯
- 登場キャラクター選択
- メモ機能

**タイムライン**:
- イベント名、タイムスタンプ
- 説明、関連章
- 時系列順の自動ソート

**プロットエクスポート機能** 🆕:
- **📋 テキストコピー**: ワンクリックでクリップボードにコピー
- **💾 ファイル出力**: `.txt`ファイルとしてダウンロード
- **出力内容**:
  - 作品情報（タイトル、ジャンル、概要）
  - 登場キャラクター一覧（詳細情報付き）
  - 章・シーン構造（場所、時間帯、登場人物、内容、メモ）
  - タイムライン（時系列イベント）
  - 出力日時

**使い方**:
1. 作品一覧から作品を選択
2. 章編集画面で「📋 テキストコピー」または「💾 ファイル出力」をクリック
3. テキストエディタ、Word、メモ帳などで編集可能

---

### 5. 🎒 鞄システム

**キャラクター別鞄**:
- 各キャラクターが独立した鞄を所持
- ガチャ結果を指定キャラクターの鞄に追加
- キャラクターごとにアイテムの所持数を管理

**共有倉庫**:
- 全キャラクター共通のストレージ
- 鞄選択で「倉庫」を選ぶと表示
- 手動でアイテムを追加・管理

**機能**:
- アイテム追加（手動入力）
- アイテム使用（個数-1）
- アイテム削除
- 鞄クリア（全削除）

---

### 6. 🖼️ 画像管理システム

**3つの画像入力方法**:
1. **URL直接入力**: 外部URLをテキストフィールドに入力
2. **ファイルアップロード**: 「ファイル」ボタンからローカル画像を選択
3. **メディアライブラリ**: 「ライブラリ」ボタンから過去の画像を再利用

**メディアライブラリ機能**:
- Base64形式でLocalStorageに保存（5MB/画像制限）
- グリッド表示で一覧
- 画像の追加・削除
- ストレージ使用量表示
- エクスポート/インポート対応

**対応箇所**:
- キャラクター画像
- モンスター画像
- アイテム画像

---

### 7. 📊 データ管理

**モンスター管理**:
- 名前、危険度、レア度
- ドロップテーブル設定
- 画像、説明

**アイテム管理**:
- 名前、種別、レア度
- 効果、画像、説明

**ドロップテーブル設定**:
- 各モンスターにアイテムとドロップ率を設定
- 合計確率の自動計算と検証
- リアルタイムで残り確率を表示

**マスタデータ管理**:
- 職業、種族のカスタマイズ
- アイテム種別の追加
- レア度の定義

**データのエクスポート/インポート**:
- JSON形式で全データを保存
- バックアップと復元
- バージョン管理（現在v2.2）
- メディアライブラリデータも含む

---

## 📊 機能一覧

### コア機能

| 機能 | 説明 |
|------|------|
| ガチャシミュレーション | 確率ベースのドロップシミュレート |
| レベル倍率 | モンスターレベルでドロップ率変動（最大300%） |
| 期待値計算 | 理論値vs実績の比較 |
| 統計・グラフ | Chart.jsによる可視化 |
| ログ記録 | 全試行の詳細履歴 |

### キャラクター・作品管理

| 機能 | 説明 |
|------|------|
| キャラクター管理 | 詳細設定、ステータス、個別鞄 |
| 作品管理 | 複数作品の管理と切り替え |
| プロット作成 | 章・シーン・タイムライン構造化 |
| プロットエクスポート | テキストコピー/ファイル出力 |
| フィルター | 作品・職業・種族で絞り込み |

### データ管理

| 機能 | 説明 |
|------|------|
| 画像管理 | URL/ファイル/ライブラリ |
| メディアライブラリ | Base64保存、5MB制限 |
| 鞄システム | キャラクター別+共有倉庫 |
| エクスポート/インポート | JSON形式、バージョン管理 |
| LocalStorage | 自動保存 |

---

## 🎮 サンプルデータ

初回起動時に自動作成されるサンプルデータ:

### モンスター (3体)
- スライム
- レッサーウルフ
- ホーンラビット

### アイテム (15種類)
- スライムゼリー
- レッサーウルフの毛皮
- 角ウサギの毛皮
- など

### マスタデータ
- 職業: 戦士、魔法使い、盗賊、僧侶
- 種族: 人間、エルフ、ドワーフ、獣人
- アイテム種別: ドロップアイテム、装備、消耗品、素材
- レア度: コモン、アンコモン、レア、エピック、レジェンド

---

## 🔧 技術スタック

- **HTML5**: セマンティックマークアップ
- **CSS3**: 
  - Grid/Flexbox レイアウト
  - CSS Variables（カラーテーマ）
  - アニメーション・トランジション
  - 完全レスポンシブデザイン
  - メディアクエリ（480px, 768px, 769-1024px, 1024px）
- **JavaScript (ES6+)**:
  - クラスベースOOP設計
  - モジュール分割
  - LocalStorage API
  - Clipboard API
  - FileReader API（画像アップロード）
  - Blob API（ファイル出力）
- **Chart.js 3.x**: データビジュアライゼーション

---

## 🎨 デザイン

- **カラーテーマ**: プロフェッショナルなブルー基調
- **カード型レイアウト**: モダンなUI設計
- **アニメーション**: スムーズな画面遷移
- **アイコン**: 絵文字で直感的な操作性
- **レスポンシブ**: 4段階のブレークポイント

---

## 📱 対応ブラウザ

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+
- モバイルブラウザ（iOS Safari, Chrome Mobile）

---

## ⚙️ カスタマイズ

### 配色変更

`css/style.css` の `:root` 部分:

```css
:root {
    --primary-color: #0078d4;
    --secondary-color: #605e5c;
    --danger-color: #d13438;
    /* ... */
}
```

### 試行回数上限変更

`js/app.js` の `runSimulation()`:

```javascript
if (trialCount <= 0 || trialCount > 100000) {
    alert('試行回数は1〜100000の範囲で入力してください');
}
```

### 画像サイズ制限変更

`js/media.js` の `addImage()`:

```javascript
const MAX_SIZE = 5 * 1024 * 1024; // 5MBに変更可能
```

---

## 🆚 VBA版との対応

| VBA機能 | Web版実装 |
|---------|----------|
| `ガチャ開始()` | `simulator.runSimulation()` |
| `期待値計算()` | `simulator.calculateExpectedValues()` |
| `AddMonster()` | `app.saveMonster()` |
| `AddItem()` | `app.saveItem()` |
| Dictionary | JavaScript Object |
| Randomize/Rnd | `Math.random()` |
| UserForm | モーダルダイアログ |
| ワークシート | LocalStorage + JSON |

---

## 💡 使用例

### 1. 新しい作品の創作開始
1. ホーム画面で「プロット作成・管理」を選択
2. 「新規作品を作成」をクリック
3. タイトル・ジャンル・概要を入力
4. 「キャラクター管理」でキャラクターを作成（作品に紐付け）
5. プロット画面で章・シーンを作成

### 2. ドロップアイテムの検証
1. モンスターとドロップテーブルを設定
2. レベル倍率を考慮してシミュレーション
3. 期待値と実績を比較
4. 確率調整してバランス取り

### 3. プロットの執筆支援
1. 章・シーン構造を作成
2. タイムラインで時系列整理
3. 「プロットエクスポート」でテキスト出力
4. Wordやメモ帳で執筆開始

---

## 🚀 今後の拡張アイデア

- [ ] マークダウン形式でのエクスポート
- [ ] PDF出力機能
- [ ] キャラクター相関図の自動生成
- [ ] 複数言語対応（i18n）
- [ ] クラウド同期機能
- [ ] テーマカラー切り替え（ダーク/ライトモード）
- [ ] ドロップ率の視覚的エディタ
- [ ] AIによるプロット提案機能

---

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

---

## 🤝 貢献

バグ報告、機能リクエスト、プルリクエストを歓迎します！

---

**Enjoy your RPG creation! 🎮✨**

- [ ] 複数モンスターの比較機能
- [ ] 確率の偏差分析
- [ ] ガチャ天井システムのシミュレーション
- [ ] テーマカラーの切り替え
- [ ] モンスター/アイテムの削除機能
- [ ] ドロップ履歴のフィルタリング
- [ ] PWA対応（オフライン動作）

## 📝 ライセンス

このプロジェクトは元のExcel VBAシステムを基に作成されています。

## 🙏 使用ライブラリ

- [Chart.js](https://www.chartjs.org/) - MIT License

---

**開発日**: 2025年12月10日
